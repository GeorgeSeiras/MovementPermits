<!DOCTYPE html>
<html>
<head>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js">
	
</script>
<meta charset="ISO-8859-1">
<title>Roles</title>
</head>
<body>
	<button type="button" onclick="roleCreate()">Create Role</button>
	<table id="rolesTable" class="rolesTable">
		<tr>
			<th>Name</th>
		</tr>
	</table>

	<button onclick="goBack()">Back</button>


	<script type="text/javascript">
		$.ajax({
			url : "/roles",
			type : "GET",
			dataType : 'json',
			cache : false,
			success : function(response) {
				rolesToTable(response, document.getElementById("rolesTable"));
			}
		});

		function rolesToTable(roles, table) {
			while (table.rows.length > 1) {
				table.deleteRow(1);
			}
			for (var i = 0; i < roles.length; i++) {
				const tr = document.createElement('tr');
				const name_td = document.createElement("td");
				const name_text = document.createTextNode(roles[i].authority);
				name_td.appendChild(name_text);

				const buttonDelete_td = document.createElement("td");
				const buttonDelete = document.createElement("BUTTON");
				buttonDelete.innerHTML = "Delete";
				var auth = roles[i].authority;
				
				var addOnClickDelete = function(auth) {
					buttonDelete.onclick = function() {
						$.ajax({
							url : "/roles/" + auth,
							type : "DELETE",
							dataType : 'json',
							cache : false,
							success : function(response) {
								var row = buttonDelete.parentNode.parentNode;
								row.parentNode.removeChild(row)
							}
						});
						
					}
				}
				addOnClickDelete(auth);
				buttonDelete_td.appendChild(buttonDelete);

				tr.appendChild(name_td);
				tr.appendChild(buttonDelete_td);
				table.appendChild(tr);
			}

		}

		function roleCreate() {
			window.location.replace("/admin/role/create");
		}
		
		function goBack() {
			window.location.replace("../admin")
		}
	</script>
</body>
</html>